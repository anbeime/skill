# 一致性管控规则（InfiniteTalk专用）

## 目录
- [1. 一致性三大维度](#1-一致性三大维度)
- [2. 角色一致性管控](#2-角色一致性管控)
- [3. 视觉连贯性管控](#3-视觉连贯性管控)
- [4. 情绪连贯性管控](#4-情绪连贯性管控)
- [5. 质量核查流程](#5-质量核查流程)
- [6. 一致性校验函数示例](#6-一致性校验函数示例)

## 概览
本文档定义InfiniteTalk生成视频的一致性管控规则，确保角色、视觉、情绪三大维度保持高度统一。

---

## 1. 一致性三大维度

### 1.1 角色一致性

**核心原则**：所有五幕提示词必须使用完全相同的角色固定特征描述

**管控维度**：
- 外貌特征：脸型、眼睛、发型、肤色、唇色
- 服饰特征：上衣、鞋子、配饰
- 气质特征：整体气质、手部姿态、身体姿态

### 1.2 视觉连贯性

**核心原则**：设定贯穿五幕的视觉线索，保持色调、场景元素、构图比例统一

**管控维度**：
- 色调：主色调贯穿五幕（冷调/暖调/中性）
- 场景元素：背景类型、道具统一
- 构图比例：9:16竖版，景深≥70%

### 1.3 情绪连贯性

**核心原则**：从第一幕到第五幕的情绪递进自然，符合场景逻辑

**管控维度**：
- 情绪基调：从第一幕到第五幕情绪递进
- 面部表情：与情绪匹配（带笑/专注/微凝/哀伤/坚定）
- 身体动作：与情绪匹配（优雅/活跃/有力）

---

## 2. 角色一致性管控

### 2.1 角色固定特征（严禁修改）

**外貌特征**：
```
性别：女性数字人
年龄：25岁左右
脸型：鹅蛋脸
眼睛：杏眼（根据情绪调整：带笑/专注/兴奋/微凝/哀伤/坚定）
发型：浅棕色齐肩卷发
肤色：白皙
唇色：淡粉
```

**服饰特征**：
```
上衣：浅灰色修身西装套裙，内搭白色衬衫
鞋子：米色细跟鞋
配饰：银色简约项链
```

**气质特征**：
```
整体气质：专业又亲和
手部姿态：优雅自然
身体姿态：挺拔/端正/微倾（根据场景调整）
```

### 2.2 角色一致性核查清单

**外貌一致性**：
- [ ] 性别一致：所有分镜都描述为"女性数字人"
- [ ] 年龄一致：所有分镜都描述为"25岁左右"
- [ ] 脸型一致：所有分镜都描述为"鹅蛋脸"
- [ ] 眼睛一致：所有分镜都描述为"杏眼"（仅允许调整情绪）
- [ ] 发型一致：所有分镜都描述为"浅棕色齐肩卷发"
- [ ] 肤色一致：所有分镜都描述为"白皙"
- [ ] 唇色一致：所有分镜都描述为"淡粉"

**服饰一致性**：
- [ ] 上衣一致：所有分镜都描述为"浅灰色修身西装套裙，内搭白色衬衫"
- [ ] 鞋子一致：所有分镜都描述为"米色细跟鞋"
- [ ] 配饰一致：所有分镜都描述为"银色简约项链"

**气质一致性**：
- [ ] 整体气质一致：所有分镜都描述为"专业又亲和"
- [ ] 手部姿态一致：所有分镜都描述为"优雅自然"
- [ ] 身体姿态合理：根据场景调整（挺拔/端正/微倾）

### 2.3 常见错误与修正

#### 错误示例1：外貌描述不一致
❌ **第一幕**："鹅蛋脸、杏眼带笑"
❌ **第二幕**："圆脸、大眼睛"
✅ **修正**：所有分镜都使用"鹅蛋脸、杏眼带笑"

#### 错误示例2：服饰描述不一致
❌ **第一幕**："浅灰色修身西装套裙"
❌ **第二幕**："蓝色职业装"
✅ **修正**：所有分镜都使用"浅灰色修身西装套裙"

#### 错误示例3：气质描述不一致
❌ **第一幕**："专业又亲和"
❌ **第三幕**："严肃冷漠"
✅ **修正**：所有分镜都使用"专业又亲和"，通过光影和氛围调整严肃感

---

## 3. 视觉连贯性管控

### 3.1 核心原则
设定贯穿五幕的视觉线索，保持色调、场景元素、构图比例统一。

### 3.2 色调连贯

**主色调**：
- **冷调**：色温4000K-4500K（专业、客观、冷静）
- **暖调**：色温5000K-5500K（热情、亲切、温暖）
- **中性**：色温4500K-5000K（平衡、自然）

**辅助色调**：根据情绪调整（暖调适配热情，冷调适配专业）

**色彩饱和度**：保持适中，避免过饱和或过淡

### 3.3 场景元素连贯

**背景统一**：
- 背景场景类型统一（商务场景）
- 背景元素一致（会议室、书房、洽谈室、大厅、办公室）

**道具一致**：
- 道具描述一致（平板、文件、桌椅、印章等）
- 道具位置合理（前景/中景/背景）

**空间关系**：
- 前景、中景、背景关系统一
- 背景虚化程度≥70%

### 3.4 构图比例连贯

**比例统一**：9:16竖版

**景别统一**：
- 中景为主（第一幕、第二幕、第四幕、第五幕）
- 近景为辅（第三幕）

**视角统一**：
- 固定镜头为主
- 顺光、侧光为主，顶光、逆光为辅
- 避免频繁切换视角

### 3.5 视觉连贯性核查清单

- [ ] **色调连贯**：主色调贯穿五幕
- [ ] **背景统一**：背景场景类型统一
- [ ] **道具一致**：道具描述一致
- [ ] **比例统一**：9:16竖版构图
- [ ] **景别合理**：景别切换合理
- [ ] **视角统一**：视角切换不频繁
- [ ] **背景虚化**：虚化程度≥70%

### 3.6 常见错误与修正

#### 错误示例1：色调不连贯
❌ **第一幕**："冷调柔光，色温4000K"
❌ **第三幕**："深蓝色商务色调，冷调强光"
✅ **修正**：保持"冷调柔光"，色温4000K-4500K

#### 错误示例2：背景不统一
❌ **第一幕**："现代商务会议室"
❌ **第三幕**："户外草坪场景"
✅ **修正**：保持"现代商务场景"

#### 错误示例3：构图比例不统一
❌ **第一幕**："9:16竖版"
❌ **第三幕**："16:9横版"
✅ **修正**：统一使用"9:16竖版"

---

## 4. 情绪连贯性管控

### 4.1 核心原则
从第一幕到第五幕的情绪递进自然，符合场景逻辑和用户体验。

### 4.2 情绪递进设计

#### 产品推荐场景情绪递进
```
第一幕（开场吸引）：热情、神秘
第二幕（产品介绍）：专业、详细
第三幕（产品演示）：专注、生动
第四幕（优势强调）：自信、有力
第五幕（行动召唤）：鼓励、坚决
```

#### 价格对比场景情绪递进
```
第一幕（开场引导）：亲切、好奇
第二幕（平台介绍）：客观、清晰
第三幕（价格对比）：理性、冷静
第四幕（优势分析）：公正、平衡
第五幕（购买建议）：鼓励、友好
```

#### 促销活动场景情绪递进
```
第一幕（活动开场）：兴奋、热烈
第二幕（优惠介绍）：紧迫、刺激
第三幕（限时秒杀）：急促、激烈
第四幕（库存告急）：危急、催促
第五幕（最后机会）：果断、坚定
```

### 4.3 情绪与面部表情匹配

| 情绪 | 面部表情 | 示例 |
|-----|---------|------|
| 热情 | 杏眼带笑 | 第一幕（开场吸引） |
| 专业 | 杏眼专注 | 第二幕（产品介绍） |
| 专注 | 杏眼专注 | 第三幕（产品演示） |
| 自信 | 杏眼带笑 | 第四幕（优势强调） |
| 鼓励 | 杏眼带笑 | 第五幕（行动召唤） |
| 微凝 | 杏眼微凝 | 特殊场景（神秘宏大） |
| 哀伤 | 杏眼哀伤 | 特殊场景（悲壮悠远） |
| 坚定 | 杏眼坚定 | 特殊场景（威严权力） |

### 4.4 情绪与光影匹配

| 情绪 | 光影 | 色温 |
|-----|------|------|
| 热情 | 暖调柔光 | 5000K-5500K |
| 专业 | 中性柔光 | 4500K-5000K |
| 冷静 | 冷调柔光 | 4000K-4500K |
| 紧迫 | 暖调强光 | 5000K-5500K |
| 悲伤 | 冷调低光 | 4000K-4500K |
| 威严 | 暖调强光 | 5000K-5500K |

### 4.5 情绪连贯性核查清单

- [ ] **情绪基调一致**：整体情绪基调一致（如专业、热情）
- [ ] **情绪递进自然**：从第一幕到第五幕情绪递进自然
- [ ] **情绪变化合理**：情绪变化符合场景逻辑
- [ ] **表情适配情绪**：面部表情与情绪匹配
- [ ] **光影适配情绪**：光影适配情绪（暖调适配热情，冷调适配专业）
- [ ] **氛围描述统一**：氛围描述与情绪一致

### 4.6 常见错误与修正

#### 错误示例1：情绪跳跃过大
❌ **第一幕**："热情、神秘"
❌ **第二幕**："严肃、冷漠"
✅ **修正**：第一幕"热情、神秘"，第二幕"专业、详细"

#### 错误示例2：情绪不递进
❌ **所有五幕**："热情、神秘"
✅ **修正**：情绪递进：热情→专业→专注→自信→鼓励

#### 错误示例3：情绪与光影不匹配
❌ **情绪描述**："热情、热烈"
❌ **光影描述**："冷调强光"
✅ **修正**：使用"暖调强光"适配热烈情绪

---

## 5. 质量核查流程

### 5.1 核查时机
- 提示词生成师生成五幕提示词后
- 质量管控师进行统一核查

### 5.2 核查顺序
1. **角色一致性核查**：确保角色描述统一
2. **视觉连贯性核查**：确保色调、场景、构图统一
3. **情绪连贯性核查**：确保情绪递进自然
4. **技术参数匹配度核查**：确保技术约束匹配InfiniteTalk能力

### 5.3 核查结果处理

#### 通过（Pass）
- 所有关键项检查通过
- 直接传递给知识库运维师归档
- 传递给跨环节适配师进行跨工具集成

#### 不通过（Fail）
- 识别具体问题
- 生成问题清单
- 反馈给提示词生成师调整
- 最多反馈2次，避免过度迭代

### 5.4 核查报告格式

```json
{
  "quality_check": "pass/fail",
  "check_results": {
    "character_consistency": {
      "status": "pass/fail",
      "details": "具体核查结果",
      "issues": []
    },
    "visual_coherence": {
      "status": "pass/fail",
      "details": "具体核查结果",
      "issues": []
    },
    "emotion_progression": {
      "status": "pass/fail",
      "details": "具体核查结果",
      "issues": []
    },
    "technical_parameters": {
      "status": "pass/fail",
      "details": "具体核查结果",
      "issues": []
    }
  },
  "issues": [
    {
      "scene_number": 3,
      "type": "角色不一致/视觉不连贯/情绪不递进/技术参数不匹配",
      "description": "具体问题描述",
      "suggestion": "修改建议"
    }
  ],
  "adjustment_needed": "true/false"
}
```

---

## 6. 一致性校验函数示例

### 6.1 角色一致性校验函数

```python
def check_character_consistency(generated_prompts, reference_character):
    """
    检查生成提示词中角色特征与参考特征的一致性

    :param generated_prompts: 生成的五幕提示词列表
    :param reference_character: 核心角色固定特征
    :return: 一致性评分（≥90分为合格）、修正指令
    """
    # 1. 提取每幕提示词中的角色描述
    character_descriptions = []
    for prompt in generated_prompts:
        # 解析"主体："字段后的内容
        subject_start = prompt.find("主体：")
        subject_end = prompt.find("；", subject_start)
        subject = prompt[subject_start + 3:subject_end].strip()
        character_descriptions.append(subject)

    # 2. 对比参考特征
    consistency_scores = []

    # 检查外貌特征一致性
    for desc in character_descriptions:
        face_score = 0
        # 检查脸型
        if "鹅蛋脸" in desc:
            face_score += 20
        # 检查眼睛
        if "杏眼" in desc:
            face_score += 20
        # 检查发型
        if "浅棕色齐肩卷发" in desc:
            face_score += 20
        # 检查肤色
        if "白皙" in desc:
            face_score += 20
        # 检查唇色
        if "淡粉" in desc:
            face_score += 20

        consistency_scores.append(face_score)

    # 检查服饰特征一致性
    for desc in character_descriptions:
        clothing_score = 0
        # 检查上衣
        if "浅灰色修身西装套裙" in desc and "白色衬衫" in desc:
            clothing_score += 35
        # 检查鞋子
        if "米色细跟鞋" in desc:
            clothing_score += 35
        # 检查配饰
        if "银色简约项链" in desc:
            clothing_score += 30

        consistency_scores.append(clothing_score)

    # 检查气质特征一致性
    for desc in character_descriptions:
        temperament_score = 0
        # 检查整体气质
        if "专业又亲和" in desc:
            temperament_score += 40
        # 检查手部姿态
        if "优雅自然" in desc or "自然" in desc:
            temperament_score += 30
        # 检查身体姿态
        if "挺拔" in desc or "端正" in desc or "微倾" in desc:
            temperament_score += 30

        consistency_scores.append(temperament_score)

    # 3. 计算平均一致性评分
    avg_consistency = sum(consistency_scores) / len(consistency_scores)

    # 4. 输出结果
    if avg_consistency < 90:
        correction = f"角色特征偏差：平均一致性{avg_consistency}%，需调整prompt中角色描述"
    else:
        correction = "角色一致性达标"

    return avg_consistency, correction
```

### 6.2 技术参数匹配度核查函数

```python
def check_technical_parameters(generated_prompts, required_parameters):
    """
    检查生成提示词中技术参数与InfiniteTalk能力的匹配度

    :param generated_prompts: 生成的五幕提示词列表
    :param required_parameters: 必需的技术参数
    :return: 匹配度评分（≥90分为合格）、修正指令
    """
    # 1. 提取每幕提示词中的技术约束
    technical_constraints = []
    for prompt in generated_prompts:
        # 解析"技术约束："字段后的内容
        tech_start = prompt.find("技术约束：")
        tech_end = prompt.find("。", tech_start)
        tech = prompt[tech_start + 5:tech_end].strip()
        technical_constraints.append(tech)

    # 2. 对比必需参数
    match_scores = []

    # 检查构图比例
    for tech in technical_constraints:
        if "9:16竖版" in tech:
            match_scores.append(25)
        else:
            match_scores.append(0)

    # 检查景深
    for tech in technical_constraints:
        if "虚化程度≥70%" in tech:
            match_scores.append(25)
        else:
            match_scores.append(0)

    # 检查动作强度
    for tech in technical_constraints:
        if "动作强度0.8" in tech:
            match_scores.append(25)
        else:
            match_scores.append(0)

    # 检查面部一致性
    for tech in technical_constraints:
        if "面部一致性启用" in tech:
            match_scores.append(25)
        else:
            match_scores.append(0)

    # 3. 计算平均匹配度评分
    avg_match = sum(match_scores) / len(match_scores)

    # 4. 输出结果
    if avg_match < 90:
        correction = f"技术参数匹配度偏差：平均匹配度{avg_match}%，需调整prompt中技术约束"
    else:
        correction = "技术参数匹配度达标"

    return avg_match, correction
```

---

## 附录：一致性速查表

### 角色一致性速查表
| 检查项 | 标准描述 | 检查结果 |
|-------|---------|---------|
| 性别 | 女性数字人 | [ ] |
| 年龄 | 25岁左右 | [ ] |
| 脸型 | 鹅蛋脸 | [ ] |
| 眼睛 | 杏眼（允许调整情绪） | [ ] |
| 发型 | 浅棕色齐肩卷发 | [ ] |
| 肤色 | 白皙 | [ ] |
| 唇色 | 淡粉 | [ ] |
| 上衣 | 浅灰色修身西装套裙，内搭白色衬衫 | [ ] |
| 鞋子 | 米色细跟鞋 | [ ] |
| 配饰 | 银色简约项链 | [ ] |
| 整体气质 | 专业又亲和 | [ ] |
| 手部姿态 | 优雅自然 | [ ] |

### 视觉连贯性速查表
| 检查项 | 标准描述 | 检查结果 |
|-------|---------|---------|
| 主色调 | 冷调/暖调/中性（贯穿五幕） | [ ] |
| 色温 | 4000K-5500K | [ ] |
| 背景类型 | 现代商务场景 | [ ] |
| 道具一致 | 平板、文件、桌椅等 | [ ] |
| 构图比例 | 9:16竖版 | [ ] |
| 景深 | ≥70% | [ ] |
| 视角 | 固定镜头为主 | [ ] |

### 情绪连贯性速查表
| 幕次 | 情绪基调 | 面部表情 | 光影 | 检查结果 |
|-----|---------|---------|------|---------|
| 第一幕 | 热情/亲切/兴奋 | 杏眼带笑 | 暖调柔光/暖调强光 | [ ] |
| 第二幕 | 专业/客观 | 杏眼专注 | 中性柔光/暖调柔光 | [ ] |
| 第三幕 | 专注/冷静 | 杏眼专注 | 冷调柔光 | [ ] |
| 第四幕 | 自信/紧迫 | 杏眼带笑 | 暖调强光/冷调强光 | [ ] |
| 第五幕 | 鼓励/坚决 | 杏眼带笑/坚定 | 暖调柔光/暖调强光 | [ ] |

---

## 注意事项

1. **严格遵循固定描述**：角色固定特征严禁修改
2. **色调贯穿始终**：主色调必须贯穿五幕
3. **情绪递进自然**：情绪变化要符合场景逻辑
4. **技术约束匹配**：技术参数必须匹配InfiniteTalk能力
5. **问题及时反馈**：发现不一致问题及时反馈给提示词生成师
6. **避免过度迭代**：最多反馈2次，避免过度迭代
